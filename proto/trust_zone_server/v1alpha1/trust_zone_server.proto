// Copyright 2026 Cofide Limited.
// SPDX-License-Identifier: Apache-2.0

syntax = "proto3";

package proto.trust_zone_server.v1alpha1;

import "google/api/field_behavior.proto";
import "google/api/resource.proto";
import "google/protobuf/struct.proto";
import "google/protobuf/timestamp.proto";

option go_package = "github.com/cofide/cofide-api-sdk/gen/go/proto/trust_zone_server/v1alpha1";

// Status of a trust zone server
enum TrustZoneServerStatus {
  TRUST_ZONE_SERVER_STATUS_UNSPECIFIED = 0;
  // Provisioning / Deleting statuses are only applicable for managed trust zone servers
  TRUST_ZONE_SERVER_STATUS_PROVISIONING = 1;
  TRUST_ZONE_SERVER_STATUS_PROVISIONED = 2;
  TRUST_ZONE_SERVER_STATUS_PROVISIONING_ERROR = 3;
  TRUST_ZONE_SERVER_STATUS_DELETING = 4;
  TRUST_ZONE_SERVER_STATUS_DELETED = 5;
  TRUST_ZONE_SERVER_STATUS_DELETING_ERROR = 6;
}

// TrustZoneServer defines how the server managing a trust zone should be deployed.
message TrustZoneServer {
  message Status {
    // Last reported status of the trust zone server.
    TrustZoneServerStatus status = 1;
    // When the status of the trust zone server last changed.
    google.protobuf.Timestamp last_transition_time = 2;
  }
  option (google.api.resource) = {
    type: "proto.trust_zone_server.v1alpha1/TrustZoneServer"
    pattern: "{trust_zone_server}"
  };
  // The unique ID of the server. Generated by the server.
  string id = 1 [(google.api.field_behavior) = IDENTIFIER];
  // Trust Zone managed by this server.
  // Immutable after creation.
  string trust_zone_id = 2 [
    (google.api.field_behavior) = REQUIRED,
    (google.api.field_behavior) = IMMUTABLE,
    (google.api.resource_reference).type = "proto.trust_zone.v1alpha1/TrustZone"
  ];
  // Cluster in which the server should be deployed.
  // Immutable after creation.
  string cluster_id = 3 [
    (google.api.field_behavior) = REQUIRED,
    (google.api.field_behavior) = IMMUTABLE,
    (google.api.resource_reference).type = "proto.cluster.v1alpha1/Cluster"
  ];
  // Kubernetes namespace in which the server should be deployed. If not provided the API service should set this.
  string kubernetes_namespace = 4 [
    (google.api.field_behavior) = OPTIONAL,
    (google.api.field_behavior) = IMMUTABLE
  ];
  // Name of kubernetes service account to deploy with the server. If not provided the API service should set this.
  string kubernetes_service_account = 5 [
    (google.api.field_behavior) = OPTIONAL,
    (google.api.field_behavior) = IMMUTABLE
  ];
  // Organization to which the server belongs. Derived from the trust zone by the API service.
  string org_id = 6 [
    (google.api.field_behavior) = OUTPUT_ONLY,
    (google.api.field_behavior) = IMMUTABLE,
    (google.api.resource_reference).type = "proto.organization.v1alpha1/Organization"
  ];
  // Helm values to configure the server install with.
  google.protobuf.Struct helm_values = 7 [(google.api.field_behavior) = OPTIONAL];
  // Current status of the trust zone server
  Status status = 8 [(google.api.field_behavior) = OUTPUT_ONLY];
  // Time of resource creation by user.
  google.protobuf.Timestamp created_at = 9 [(google.api.field_behavior) = OUTPUT_ONLY];
  // Times of last resource update by user.
  google.protobuf.Timestamp last_updated_at = 10 [(google.api.field_behavior) = OUTPUT_ONLY];
  // Time of resource deletion by user.
  google.protobuf.Timestamp deleted_at = 11 [(google.api.field_behavior) = OUTPUT_ONLY];
}
