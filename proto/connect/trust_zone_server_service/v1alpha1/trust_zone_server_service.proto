// Copyright 2026 Cofide Limited.
// SPDX-License-Identifier: Apache-2.0

syntax = "proto3";

package proto.connect.trust_zone_server_service.v1alpha1;

import "google/api/field_behavior.proto";
import "google/api/resource.proto";
import "proto/trust_zone_server/v1alpha1/trust_zone_server.proto";

option go_package = "github.com/cofide/cofide-api-sdk/gen/go/proto/connect/trust_zone_server_service/v1alpha1";

// TrustZoneServerService manages TrustZoneServers.
service TrustZoneServerService {
  // Create a TrustZoneServer for the given trust zone in the specified cluster.
  // In the submitted resource the ID should not be set and will be generated by the server API.
  rpc CreateTrustZoneServer(CreateTrustZoneServerRequest) returns (CreateTrustZoneServerResponse) {}
  // Destroy a TrustZoneServer.
  // For managed TrustZoneServers this should soft delete the API resource until the managed server is deprovisioned.
  rpc DestroyTrustZoneServer(DestroyTrustZoneServerRequest) returns (DestroyTrustZoneServerResponse) {}
  // Get a TrustZoneServer by ID.
  rpc GetTrustZoneServer(GetTrustZoneServerRequest) returns (GetTrustZoneServerResponse) {}
  // List TrustZoneServers.
  rpc ListTrustZoneServers(ListTrustZoneServersRequest) returns (ListTrustZoneServersResponse) {}
  // Update a TrustZoneServer.
  // Server implementations may prevent some fields from being updated.
  rpc UpdateTrustZoneServer(UpdateTrustZoneServerRequest) returns (UpdateTrustZoneServerResponse) {}
  // Creates a temporary token that can be used by a server to register with Connect.
  // Usually servers should register using a non-shared token that can be verified by the API server, join tokens should
  // only be used when this is not possible.
  rpc CreateJoinToken(CreateJoinTokenRequest) returns (CreateJoinTokenResponse) {}
}

message CreateTrustZoneServerRequest {
  proto.trust_zone_server.v1alpha1.TrustZoneServer trust_zone_server = 1 [(google.api.field_behavior) = REQUIRED];
}

message CreateTrustZoneServerResponse {
  proto.trust_zone_server.v1alpha1.TrustZoneServer trust_zone_server = 1;
}

message DestroyTrustZoneServerRequest {
  string trust_zone_server_id = 1 [
    (google.api.field_behavior) = REQUIRED,
    (google.api.resource_reference).type = "proto.trust_zone_server.v1alpha1/TrustZoneServer"
  ];
}

message DestroyTrustZoneServerResponse {}

message GetTrustZoneServerRequest {
  string trust_zone_server_id = 1 [
    (google.api.field_behavior) = REQUIRED,
    (google.api.resource_reference).type = "proto.trust_zone_server.v1alpha1/TrustZoneServer"
  ];
}

message GetTrustZoneServerResponse {
  optional proto.trust_zone_server.v1alpha1.TrustZoneServer trust_zone_server = 1;
}

message ListTrustZoneServersRequest {
  message Filter {
    string trust_zone_id = 1 [
      (google.api.field_behavior) = OPTIONAL,
      (google.api.resource_reference).type = "proto.trust_zone.v1alpha1/TrustZone"
    ];
    string cluster_id = 2 [
      (google.api.field_behavior) = OPTIONAL,
      (google.api.resource_reference).type = "proto.cluster.v1alpha1/Cluster"
    ];
    string org_id = 3 [
      (google.api.field_behavior) = OPTIONAL,
      (google.api.resource_reference).type = "proto.organization.v1alpha1/Organization"
    ];
  }
  Filter filter = 1 [(google.api.field_behavior) = OPTIONAL];
}

message ListTrustZoneServersResponse {
  repeated proto.trust_zone_server.v1alpha1.TrustZoneServer trust_zone_servers = 1;
}

message UpdateTrustZoneServerRequest {
  message UpdateMask {
    // Set to true to update helm values of trust zone server to those provided.
    bool helm_values = 1 [(google.api.field_behavior) = OPTIONAL];
  }

  proto.trust_zone_server.v1alpha1.TrustZoneServer trust_zone_server = 1 [(google.api.field_behavior) = REQUIRED];

  // The list of fields to be updated. If not provided a full replacement will be made.
  optional UpdateMask update_mask = 2 [(google.api.field_behavior) = OPTIONAL];
}

message UpdateTrustZoneServerResponse {
  proto.trust_zone_server.v1alpha1.TrustZoneServer trust_zone_server = 1;
}

message CreateJoinTokenRequest {
  string trust_zone_server_id = 1 [
    (google.api.field_behavior) = REQUIRED,
    (google.api.resource_reference).type = "proto.trust_zone_server.v1alpha1/TrustZoneServer"
  ];
}

message CreateJoinTokenResponse {
  string join_token = 1;
}
